<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AquaVolt</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,700;1,300&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg:        #020d0f;
  --bg2:       #041418;
  --bg3:       #071e24;
  --surface:   rgba(4,28,34,.9);
  --teal:      #00e5c8;
  --teal2:     #00bfa5;
  --teal3:     rgba(0,229,200,.15);
  --green:     #00ff88;
  --green2:    #00cc6a;
  --green3:    rgba(0,255,136,.12);
  --gold:      #ffd700;
  --gold2:     #f5b800;
  --gold3:     rgba(255,215,0,.15);
  --blue:      #0099cc;
  --blue2:     #007aaa;
  --white:     #e8f8f5;
  --dim:       #0e2a30;
  --muted:     #4a8a90;
  --border:    rgba(0,229,200,.15);
  --border2:   rgba(255,215,0,.2);
  --red:       #ff5555;
}
html{scroll-behavior:smooth;}
body{
  font-family:'DM Sans',sans-serif;
  background:var(--bg);
  min-height:100vh;
  overflow-x:hidden;
  color:var(--white);
}

/* ‚îÄ‚îÄ‚îÄ ANIMATED BG ‚îÄ‚îÄ‚îÄ */
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 60% 50% at 10% 20%, rgba(0,229,200,.07) 0%, transparent 60%),
    radial-gradient(ellipse 50% 60% at 90% 80%, rgba(0,255,136,.06) 0%, transparent 60%),
    radial-gradient(ellipse 40% 40% at 50% 50%, rgba(255,215,0,.03) 0%, transparent 70%);
}
body::after{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:
    linear-gradient(rgba(0,229,200,.025) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,229,200,.025) 1px, transparent 1px);
  background-size:60px 60px;
  mask-image:radial-gradient(ellipse 80% 80% at 50% 50%, black 30%, transparent 100%);
}

canvas#bgCv{position:fixed;inset:0;z-index:0;pointer-events:none;}

/* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
.screen{display:none;position:relative;z-index:1;min-height:100vh;animation:fadeUp .5s cubic-bezier(.22,1,.36,1) both;}
.screen.active{display:flex;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}

/* ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ */
.auth-wrap{flex-direction:column;align-items:center;justify-content:center;padding:2rem 1.25rem;}

/* Logo */
.logo-block{text-align:center;margin-bottom:2rem;}
.logo-emblem{
  width:80px;height:80px;margin:0 auto 1.2rem;
  position:relative;display:flex;align-items:center;justify-content:center;
}
.logo-emblem svg{position:absolute;inset:0;width:100%;height:100%;animation:spinSlow 12s linear infinite;}
.logo-emblem svg.rev{animation-direction:reverse;animation-duration:8s;}
.logo-glyph{
  position:relative;z-index:1;
  font-size:2rem;
  filter:drop-shadow(0 0 12px var(--teal));
  animation:pulse 3s ease-in-out infinite;
}
@keyframes spinSlow{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{filter:drop-shadow(0 0 8px var(--teal))}50%{filter:drop-shadow(0 0 20px var(--teal)) drop-shadow(0 0 40px rgba(0,229,200,.4))}}
.logo-wordmark{
  font-family:'Orbitron',monospace;font-size:2.6rem;font-weight:900;
  letter-spacing:6px;line-height:1;color:var(--white);
}
.logo-wordmark em{color:var(--gold);font-style:normal;}
.logo-tagline{
  font-family:'Space Mono',monospace;font-size:.6rem;
  color:var(--muted);letter-spacing:4px;text-transform:uppercase;margin-top:.5rem;
}

/* Card */
.card{
  width:100%;max-width:460px;
  background:var(--surface);
  backdrop-filter:blur(32px);
  border:1px solid var(--border);
  border-radius:12px;
  padding:2.2rem;
  position:relative;overflow:hidden;
}
.card::before{
  content:'';position:absolute;top:0;left:10%;right:10%;height:1px;
  background:linear-gradient(90deg,transparent,var(--teal),var(--green),var(--gold),transparent);
  opacity:.7;
}
.card::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:120px;
  background:radial-gradient(ellipse 80% 100% at 50% 100%, rgba(0,229,200,.05), transparent);
  pointer-events:none;
}
.card-title{font-family:'Orbitron',monospace;font-size:1.5rem;font-weight:700;letter-spacing:2px;color:var(--white);margin-bottom:.25rem;}
.card-sub{font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);margin-bottom:1.8rem;letter-spacing:.5px;}

/* Fields */
.field{margin-bottom:.85rem;}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;}
label{
  display:block;font-family:'Space Mono',monospace;
  font-size:.6rem;color:var(--teal);
  margin-bottom:.45rem;letter-spacing:2px;text-transform:uppercase;
}
input{
  width:100%;background:rgba(0,0,0,.4);
  border:1px solid var(--border);border-radius:8px;
  padding:.8rem 1rem;color:var(--white);
  font-family:'DM Sans',sans-serif;font-size:.9rem;
  transition:all .2s;outline:none;
}
input::placeholder{color:rgba(74,138,144,.45);}
input:focus{
  border-color:var(--teal);
  background:rgba(0,229,200,.04);
  box-shadow:0 0 0 3px rgba(0,229,200,.1), 0 0 30px rgba(0,229,200,.05);
}

/* Buttons */
.btn{
  width:100%;padding:.9rem 1.5rem;border:none;border-radius:8px;
  font-family:'Orbitron',monospace;font-size:.8rem;font-weight:700;
  cursor:pointer;transition:all .22s;position:relative;overflow:hidden;
  letter-spacing:2px;text-transform:uppercase;
}
.btn:active{transform:scale(.97);}
.btn-primary{
  background:linear-gradient(135deg, var(--teal2) 0%, var(--teal) 50%, var(--green2) 100%);
  color:var(--bg);
  box-shadow:0 0 24px rgba(0,229,200,.35), inset 0 1px 0 rgba(255,255,255,.2);
}
.btn-primary:hover{box-shadow:0 0 40px rgba(0,229,200,.55), inset 0 1px 0 rgba(255,255,255,.2);}
.btn-gold{
  background:linear-gradient(135deg, var(--gold2) 0%, var(--gold) 100%);
  color:var(--bg);
  box-shadow:0 0 24px rgba(255,215,0,.3);
}
.btn-gold:hover{box-shadow:0 0 40px rgba(255,215,0,.5);}
.btn-ghost{
  background:transparent;color:var(--muted);
  border:1px solid var(--border);margin-top:.5rem;
}
.btn-ghost:hover{border-color:var(--teal);color:var(--teal);}
.btn-danger{background:rgba(255,85,85,.1);color:#ff8080;border:1px solid rgba(255,85,85,.25);}
.btn-danger:hover{background:rgba(255,85,85,.2);}
.btn-water{
  background:linear-gradient(135deg, var(--blue2), var(--blue));
  color:var(--white);box-shadow:0 0 20px rgba(0,153,204,.3);
}
.btn-water:hover{box-shadow:0 0 36px rgba(0,153,204,.5);}

.divider{display:flex;align-items:center;gap:.75rem;margin:.9rem 0;color:var(--muted);font-family:'Space Mono',monospace;font-size:.6rem;letter-spacing:2px;}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}

.error-msg{font-family:'Space Mono',monospace;font-size:.62rem;color:#ff8080;margin-top:.3rem;display:none;letter-spacing:.5px;}
.error-msg.show{display:block;}

/* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
#toast{
  position:fixed;top:1.2rem;left:50%;
  transform:translateX(-50%) translateY(-80px);z-index:999;
  max-width:360px;width:92%;padding:.85rem 1.2rem;border-radius:10px;
  font-family:'Space Mono',monospace;font-size:.72rem;
  display:flex;align-items:center;gap:.6rem;
  transition:transform .35s cubic-bezier(.22,1,.36,1),opacity .3s;
  opacity:0;pointer-events:none;letter-spacing:.5px;
}
#toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
#toast.success{background:rgba(0,180,100,.95);color:#fff;border:1px solid rgba(0,255,136,.3);}
#toast.error{background:rgba(200,40,40,.95);color:#fff;border:1px solid rgba(255,80,80,.3);}

/* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
#loadingOverlay{display:none;position:fixed;inset:0;z-index:990;background:rgba(2,13,15,.9);backdrop-filter:blur(12px);align-items:center;justify-content:center;flex-direction:column;gap:1rem;}
#loadingOverlay.show{display:flex;}
.spinner{
  width:48px;height:48px;border-radius:50%;
  border:2px solid rgba(0,229,200,.1);
  border-top-color:var(--teal);
  border-right-color:var(--gold);
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--teal);letter-spacing:3px;animation:blink 1.3s ease infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DASHBOARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.dash-screen{flex-direction:column;min-height:100vh;padding-bottom:5.5rem;}

/* TOPBAR */
.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:.9rem 1.25rem;
  position:sticky;top:0;z-index:50;
  background:rgba(2,13,15,.92);backdrop-filter:blur(24px);
  border-bottom:1px solid var(--border);
}
.tb-brand{font-family:'Orbitron',monospace;font-size:1.2rem;font-weight:900;letter-spacing:4px;color:var(--white);}
.tb-brand em{color:var(--gold);font-style:normal;}
.tb-right{display:flex;align-items:center;gap:.75rem;}
.user-pill{
  display:flex;align-items:center;gap:.55rem;
  background:rgba(0,0,0,.35);border:1px solid var(--border);
  border-radius:20px;padding:.3rem .75rem .3rem .35rem;
}
.u-avatar{
  width:28px;height:28px;border-radius:50%;
  background:linear-gradient(135deg, var(--teal2), var(--gold));
  display:flex;align-items:center;justify-content:center;
  font-family:'Orbitron',monospace;font-size:.7rem;font-weight:700;color:var(--bg);
}
.u-name{font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:700;color:var(--white);}
.u-city{font-family:'Space Mono',monospace;font-size:.56rem;color:var(--muted);}
.logout-btn{background:transparent;border:none;cursor:pointer;color:var(--muted);font-size:1rem;padding:.2rem;transition:color .2s;}
.logout-btn:hover{color:var(--red);}

/* HERO */
.dash-hero{padding:1.2rem 1.25rem 0;}
.hero-card{
  border-radius:16px;overflow:hidden;
  background:linear-gradient(135deg, var(--bg3) 0%, rgba(0,40,48,.8) 100%);
  border:1px solid var(--border);
  padding:1.6rem;position:relative;
}
.hero-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg, var(--teal), var(--green), var(--gold));
}
.hero-card::after{
  content:'AQUA';
  font-family:'Orbitron',monospace;font-size:8rem;font-weight:900;letter-spacing:16px;
  position:absolute;right:-2rem;bottom:-2rem;
  color:rgba(0,229,200,.03);pointer-events:none;line-height:1;
}
.hero-eyebrow{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--teal);letter-spacing:3px;text-transform:uppercase;margin-bottom:.3rem;}
.hero-name{font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;letter-spacing:2px;color:var(--white);line-height:1.1;margin-bottom:.4rem;}
.hero-loc{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--muted);margin-bottom:1.2rem;display:flex;align-items:center;gap:.4rem;}
.hero-loc::before{content:'‚óà';color:var(--teal);}
.kpi-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;}
.kpi{
  background:rgba(0,0,0,.35);border:1px solid var(--border);
  border-radius:10px;padding:.9rem;position:relative;overflow:hidden;
}
.kpi::before{content:'';position:absolute;top:0;left:0;bottom:0;width:2px;background:var(--teal);}
.kpi.gold::before{background:var(--gold);}
.kpi-label{font-family:'Space Mono',monospace;font-size:.55rem;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:.25rem;}
.kpi-val{font-family:'Orbitron',monospace;font-size:1.4rem;font-weight:700;letter-spacing:1px;color:var(--white);}
.kpi-val.gold{color:var(--gold);}

/* NAV */
.dash-nav{
  display:flex;padding:.9rem 1.25rem .4rem;
  gap:.4rem;
}
.nav-item{
  flex:1;padding:.65rem .3rem;border-radius:10px;
  background:transparent;border:1px solid var(--border);
  color:var(--muted);font-family:'Space Mono',monospace;
  font-size:.58rem;font-weight:700;letter-spacing:.5px;
  cursor:pointer;transition:all .2s;
  display:flex;flex-direction:column;align-items:center;gap:.28rem;
  text-transform:uppercase;
}
.nav-item .ni-icon{font-size:1.1rem;}
.nav-item:hover{background:rgba(0,229,200,.07);color:var(--white);}
.nav-item.active{background:rgba(0,229,200,.12);border-color:var(--teal);color:var(--teal);}
.nav-item.active-sim{background:rgba(255,215,0,.1);border-color:var(--gold);color:var(--gold);}

/* PANELS */
.panel{padding:1rem 1.25rem;display:none;flex-direction:column;gap:.8rem;}
.panel.visible{display:flex;}

/* HISTORY LIST */
.c-item{
  background:var(--bg2);border:1px solid var(--border);border-radius:12px;
  padding:1rem;display:flex;align-items:center;gap:.85rem;
  animation:itemIn .35s cubic-bezier(.22,1,.36,1) both;
  transition:all .2s;position:relative;overflow:hidden;
}
.c-item:hover{border-color:rgba(0,229,200,.3);transform:translateX(3px);}
.c-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--teal);border-radius:0 3px 3px 0;}
.c-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.c-info{flex:1;min-width:0;}
.c-tipo{font-size:.88rem;font-weight:700;color:var(--white);}
.c-data{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--muted);margin-top:.15rem;}
.c-right{display:flex;align-items:center;gap:.5rem;}
.c-val{font-family:'Orbitron',monospace;font-size:1.05rem;font-weight:700;color:var(--gold);}
.del-btn{
  width:28px;height:28px;border-radius:8px;border:1px solid rgba(255,85,85,.2);
  background:rgba(255,85,85,.08);color:#ff8080;font-size:.7rem;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .18s;
}
.del-btn:hover{background:rgba(255,85,85,.22);}
.empty-state{text-align:center;padding:3rem 1rem;color:var(--muted);}
.empty-icon{font-size:3rem;margin-bottom:.75rem;opacity:.25;}
.empty-state p{font-family:'Space Mono',monospace;font-size:.7rem;line-height:1.9;letter-spacing:.5px;}

/* CHARTS */
.period-bar{display:flex;gap:.3rem;border-radius:10px;overflow:hidden;}
.pb{
  flex:1;padding:.5rem .25rem;border-radius:8px;
  border:1px solid var(--border);background:transparent;
  color:var(--muted);font-family:'Space Mono',monospace;font-size:.6rem;
  cursor:pointer;transition:all .18s;letter-spacing:1px;
}
.pb.active{background:rgba(0,229,200,.14);color:var(--teal);border-color:var(--teal);}
.pb:hover:not(.active){color:var(--white);}
.sum-row{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem;}
.sum-chip{background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:.8rem .7rem;text-align:center;position:relative;overflow:hidden;}
.sum-chip::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--teal),transparent);}
.sum-v{font-family:'Orbitron',monospace;font-size:1.1rem;font-weight:700;color:var(--white);}
.sum-l{font-family:'Space Mono',monospace;font-size:.52rem;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:.2rem;}
.chart-box{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:1.2rem;}
.chart-ttl{font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;letter-spacing:2px;color:var(--white);margin-bottom:.15rem;}
.chart-sub{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--muted);margin-bottom:1rem;letter-spacing:.5px;}
.no-data{display:flex;flex-direction:column;align-items:center;padding:2.2rem;color:var(--muted);gap:.4rem;text-align:center;}
.no-data-icon{font-size:1.5rem;opacity:.25;}
.no-data p{font-family:'Space Mono',monospace;font-size:.65rem;letter-spacing:.5px;}

/* CAT BARS */
.cat-bars{display:flex;flex-direction:column;gap:.85rem;}
.cat-row{display:flex;flex-direction:column;gap:.32rem;}
.cat-top{display:flex;justify-content:space-between;align-items:center;}
.cat-nm{display:flex;align-items:center;gap:.45rem;font-size:.8rem;font-weight:700;color:var(--white);}
.cat-amt{font-family:'Orbitron',monospace;font-size:.85rem;font-weight:700;color:var(--gold);}
.cat-track{height:5px;background:rgba(255,255,255,.05);border-radius:99px;overflow:hidden;}
.cat-fill{height:100%;border-radius:99px;transition:width 1.2s cubic-bezier(.22,1,.36,1);}
.cat-pct{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--muted);}

/* SIMULATION */
.sim-hero{
  background:var(--bg2);border:1px solid var(--border2);border-radius:14px;
  padding:1.4rem;position:relative;overflow:hidden;
}
.sim-hero::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--gold2),transparent);}
.sim-ttl{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:900;letter-spacing:2px;color:var(--white);margin-bottom:.3rem;}
.sim-desc{font-family:'DM Sans',sans-serif;font-size:.8rem;color:var(--muted);line-height:1.6;margin-bottom:.8rem;}
.sim-region-tag{
  display:inline-flex;align-items:center;gap:.4rem;
  background:rgba(255,215,0,.1);border:1px solid var(--border2);
  border-radius:99px;padding:.3rem .9rem;
  font-family:'Space Mono',monospace;font-size:.62rem;
  color:var(--gold);letter-spacing:1.5px;
}
.type-grid{display:grid;grid-template-columns:1fr 1fr;gap:.8rem;}
.type-card{
  border:2px solid transparent;border-radius:14px;padding:1.6rem 1rem 1.4rem;
  display:flex;flex-direction:column;align-items:center;gap:.6rem;
  cursor:pointer;transition:all .25s;position:relative;overflow:hidden;
}
.tc-water{background:rgba(0,153,204,.08);border-color:rgba(0,153,204,.2);}
.tc-energy{background:rgba(255,215,0,.07);border-color:rgba(255,215,0,.2);}
.type-card.sel-water{border-color:var(--teal);box-shadow:0 0 0 3px rgba(0,229,200,.12),0 0 24px rgba(0,229,200,.1);}
.type-card.sel-energy{border-color:var(--gold);box-shadow:0 0 0 3px rgba(255,215,0,.12),0 0 24px rgba(255,215,0,.1);}
.tc-icon{font-size:2.4rem;transition:transform .25s;}
.type-card:hover .tc-icon{transform:scale(1.12) translateY(-3px);}
.tc-lbl{font-family:'Orbitron',monospace;font-size:1.1rem;font-weight:700;letter-spacing:2px;color:var(--white);}
.tc-unit{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--muted);border:1px solid var(--border);border-radius:4px;padding:.15rem .5rem;letter-spacing:2px;}
.sim-form{background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:1.3rem;animation:fadeUp .3s ease both;}
.sim-form-ttl{font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;letter-spacing:2px;color:var(--white);margin-bottom:1rem;display:flex;align-items:center;gap:.6rem;}
.unit-badge{font-family:'Space Mono',monospace;font-size:.58rem;border:1px solid currentColor;border-radius:4px;padding:.15rem .5rem;letter-spacing:2px;}
.unit-badge.water{color:var(--teal);}
.unit-badge.energy{color:var(--gold);}

/* RESULT */
.sim-result{
  background:var(--bg2);border:2px solid var(--border2);border-radius:14px;
  padding:1.5rem;position:relative;overflow:hidden;animation:fadeUp .4s ease both;
}
.sim-result::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--gold),var(--teal),transparent);}
.res-label{font-family:'Space Mono',monospace;font-size:.58rem;color:var(--gold);letter-spacing:3px;text-transform:uppercase;margin-bottom:.7rem;}
.res-value{font-family:'Orbitron',monospace;font-size:3rem;font-weight:900;letter-spacing:1px;color:var(--white);line-height:1;margin-bottom:.35rem;}
.res-value small{font-size:1.4rem;color:var(--gold);}
.res-detail{font-family:'DM Sans',sans-serif;font-size:.82rem;color:var(--muted);line-height:1.7;margin-bottom:1.1rem;}
.res-grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem;}
.res-chip{background:rgba(0,0,0,.3);border:1px solid var(--border);border-radius:10px;padding:.7rem .9rem;}
.res-chip-lbl{font-family:'Space Mono',monospace;font-size:.55rem;color:var(--muted);letter-spacing:1.5px;margin-bottom:.25rem;}
.res-chip-val{font-family:'Orbitron',monospace;font-size:.95rem;font-weight:700;color:var(--white);}

/* SIM HISTORY */
.sim-hist-header{display:flex;align-items:center;justify-content:space-between;}
.sim-hist-ttl{font-family:'Orbitron',monospace;font-size:.95rem;font-weight:700;letter-spacing:2px;color:var(--white);}
.sim-hist-count{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--muted);}
.sh-item{
  background:var(--bg2);border:1px solid var(--border);border-radius:12px;
  padding:.9rem 1rem;display:flex;align-items:center;gap:.75rem;
  animation:itemIn .35s ease both;transition:all .2s;
}
.sh-item:hover{border-color:rgba(255,215,0,.25);}
.sh-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;}
.sh-info{flex:1;min-width:0;}
.sh-ativ{font-size:.82rem;font-weight:700;color:var(--white);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sh-meta{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--muted);margin-top:.1rem;}
.sh-val{font-family:'Orbitron',monospace;font-size:1rem;font-weight:700;color:var(--gold);}

/* FAB */
.fab{
  position:fixed;bottom:1.8rem;right:1.25rem;z-index:100;
  width:58px;height:58px;border-radius:16px;border:none;cursor:pointer;
  background:linear-gradient(135deg, var(--teal2), var(--teal), var(--green2));
  display:flex;align-items:center;justify-content:center;
  font-size:1.6rem;font-weight:300;color:var(--bg);
  transition:transform .2s,box-shadow .2s;
  box-shadow:0 0 20px rgba(0,229,200,.4), 0 4px 20px rgba(0,0,0,.5);
  animation:fabPulse 3s ease-in-out infinite;
}
@keyframes fabPulse{0%,100%{box-shadow:0 0 20px rgba(0,229,200,.4),0 4px 20px rgba(0,0,0,.5)}50%{box-shadow:0 0 36px rgba(0,229,200,.7),0 4px 20px rgba(0,0,0,.5)}}
.fab:hover{transform:scale(1.08) rotate(90deg);box-shadow:0 0 50px rgba(0,229,200,.8),0 4px 24px rgba(0,0,0,.5);}
.fab:active{transform:scale(.93);}

/* MODALS */
.modal-backdrop{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.75);backdrop-filter:blur(12px);align-items:flex-end;justify-content:center;}
.modal-backdrop.open{display:flex;}
.modal{
  background:var(--bg2);border:1px solid var(--border);border-radius:20px 20px 0 0;
  padding:1.4rem 1.4rem 2.8rem;width:100%;max-width:480px;
  animation:slideUp .38s cubic-bezier(.22,1,.36,1) both;position:relative;
}
.modal::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,var(--teal),var(--gold),transparent);opacity:.7;}
@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{opacity:1;transform:none}}
.modal-handle{width:40px;height:4px;background:var(--dim);border-radius:99px;margin:0 auto 1.4rem;}
.modal-title{font-family:'Orbitron',monospace;font-size:1.4rem;font-weight:700;letter-spacing:2px;color:var(--white);margin-bottom:.2rem;}
.modal-sub{font-family:'Space Mono',monospace;font-size:.65rem;color:var(--muted);margin-bottom:1.5rem;letter-spacing:.3px;}
.confirm-modal{
  background:var(--bg2);border:1px solid rgba(255,85,85,.25);border-radius:20px 20px 0 0;
  padding:1.4rem 1.4rem 2.8rem;width:100%;max-width:420px;
  animation:slideUp .35s ease both;text-align:center;
}
.confirm-icon{font-size:2.5rem;margin-bottom:.75rem;}
.confirm-title{font-family:'Orbitron',monospace;font-size:1.3rem;font-weight:700;letter-spacing:2px;color:var(--white);margin-bottom:.35rem;}
.confirm-sub{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--muted);margin-bottom:1.5rem;line-height:1.6;letter-spacing:.3px;}
.confirm-row{display:flex;gap:.6rem;}
.confirm-row .btn{margin-top:0;}

/* TIPO GRID (modal) */
.tipo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;margin-bottom:1rem;}
.tipo-btn{
  border:1px solid var(--border);background:rgba(0,0,0,.2);
  border-radius:10px;padding:.7rem .4rem;
  display:flex;flex-direction:column;align-items:center;gap:.3rem;
  cursor:pointer;transition:all .2s;color:var(--muted);
  font-family:'DM Sans',sans-serif;font-size:.68rem;font-weight:700;letter-spacing:.5px;
}
.tipo-btn span{font-size:1.3rem;}
.tipo-btn:hover{background:rgba(0,229,200,.08);color:var(--white);}
.tipo-btn.selected{background:rgba(0,229,200,.14);border-color:var(--teal);color:var(--teal);}

@keyframes itemIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:none}}

@media(min-width:600px){
  .modal,.confirm-modal{border-radius:20px;margin-bottom:2rem;}
  .card{padding:2.6rem 2.4rem;}
}
</style>
</head>
<body>

<canvas id="bgCv"></canvas>
<div id="loadingOverlay"><div class="spinner"></div><div class="loading-text">PROCESSANDO...</div></div>
<div id="toast"><span class="t-icon"></span><span id="toastMsg"></span></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CADASTRO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screenCadastro" class="screen auth-wrap active">
  <div class="logo-block">
    <div class="logo-emblem">
      <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="50,2 95,26 95,74 50,98 5,74 5,26" stroke="rgba(0,229,200,.5)" stroke-width="1.5" fill="none" stroke-dasharray="4 6"/>
      </svg>
      <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="rev">
        <polygon points="50,8 89,29 89,71 50,92 11,71 11,29" stroke="rgba(255,215,0,.35)" stroke-width="1" fill="none" stroke-dasharray="2 4"/>
      </svg>
      <div class="logo-glyph">‚óà</div>
    </div>
    <div class="logo-wordmark">Aqua<em>Volt</em></div>
    <div class="logo-tagline">// sistema de monitoramento</div>
  </div>
  <div class="card">
    <div class="card-title">Criar conta</div>
    <div class="card-sub">// preencha os dados para come√ßar</div>
    <div class="field"><label>nome completo</label><input id="cad-nome" type="text" placeholder="Seu nome"><div class="error-msg" id="err-cad-nome">campo obrigat√≥rio</div></div>
    <div class="field-row">
      <div class="field"><label>e-mail</label><input id="cad-email" type="email" placeholder="email@ex.com"><div class="error-msg" id="err-cad-email">e-mail inv√°lido</div></div>
      <div class="field"><label>cidade</label><input id="cad-cidade" type="text" placeholder="Ex: Bras√≠lia"><div class="error-msg" id="err-cad-cidade">campo obrigat√≥rio</div></div>
    </div>
    <div class="field"><label>senha</label><input id="cad-senha" type="password" placeholder="m√≠n. 6 caracteres"><div class="error-msg" id="err-cad-senha">senha muito curta</div></div>
    <button class="btn btn-primary" onclick="cadastrar()">Criar conta ‚Üí</button>
    <div class="divider">ou</div>
    <button class="btn btn-ghost" onclick="showScreen('screenLogin')">J√° tenho uma conta</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screenLogin" class="screen auth-wrap">
  <div class="logo-block">
    <div class="logo-emblem">
      <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="50,2 95,26 95,74 50,98 5,74 5,26" stroke="rgba(0,229,200,.5)" stroke-width="1.5" fill="none" stroke-dasharray="4 6"/>
      </svg>
      <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="rev">
        <polygon points="50,8 89,29 89,71 50,92 11,71 11,29" stroke="rgba(255,215,0,.35)" stroke-width="1" fill="none" stroke-dasharray="2 4"/>
      </svg>
      <div class="logo-glyph">‚óà</div>
    </div>
    <div class="logo-wordmark">Aqua<em>Volt</em></div>
    <div class="logo-tagline">// autentica√ß√£o do sistema</div>
  </div>
  <div class="card">
    <div class="card-title">Entrar</div>
    <div class="card-sub">// insira suas credenciais</div>
    <div class="field"><label>e-mail</label><input id="log-email" type="email" placeholder="email@exemplo.com"><div class="error-msg" id="err-log-email">e-mail inv√°lido</div></div>
    <div class="field"><label>senha</label><input id="log-senha" type="password" placeholder="sua senha"><div class="error-msg" id="err-log-senha">campo obrigat√≥rio</div></div>
    <button class="btn btn-primary" onclick="login()">Entrar ‚Üí</button>
    <div class="divider">ou</div>
    <button class="btn btn-ghost" onclick="showScreen('screenCadastro')">Criar nova conta</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="screenMenu" class="screen dash-screen">

  <div class="topbar">
    <div class="tb-brand">Aqua<em>Volt</em></div>
    <div class="tb-right">
      <div class="user-pill">
        <div class="u-avatar" id="userAvatar">?</div>
        <div>
          <div class="u-name" id="userNameDisplay">‚Äî</div>
          <div class="u-city" id="userCityDisplay">‚Äî</div>
        </div>
      </div>
      <button class="logout-btn" onclick="logout()" title="Sair">‚èª</button>
    </div>
  </div>

  <!-- HERO -->
  <div class="dash-hero">
    <div class="hero-card">
      <div class="hero-eyebrow">painel de consumo</div>
      <div class="hero-name" id="heroName">‚Äî</div>
      <div class="hero-loc" id="heroLoc">‚Äî</div>
      <div class="kpi-row">
        <div class="kpi"><div class="kpi-label">Registros</div><div class="kpi-val" id="statTotal">0</div></div>
        <div class="kpi gold"><div class="kpi-label">Total gasto</div><div class="kpi-val gold" id="statGasto">R$ 0</div></div>
      </div>
    </div>
  </div>

  <!-- NAV TABS -->
  <div class="dash-nav">
    <button class="nav-item active" id="tabH" onclick="switchTab('h')">
      <span class="ni-icon">üìã</span>Hist√≥rico
    </button>
    <button class="nav-item" id="tabG" onclick="switchTab('g')">
      <span class="ni-icon">üìä</span>Gr√°ficos
    </button>
    <button class="nav-item" id="tabS" onclick="switchTab('s')">
      <span class="ni-icon">‚ö°</span>Simular
    </button>
  </div>

  <!-- HIST√ìRICO -->
  <div class="panel visible" id="panelH">
    <div id="consumoList">
      <div class="empty-state">
        <div class="empty-icon">‚óà</div>
        <p>nenhum registro encontrado<br>pressione + para adicionar</p>
      </div>
    </div>
  </div>

  <!-- GR√ÅFICOS -->
  <div class="panel" id="panelG">
    <div class="period-bar">
      <button class="pb active" onclick="setPeriod(this,'all')">TUDO</button>
      <button class="pb" onclick="setPeriod(this,'year')">ANO</button>
      <button class="pb" onclick="setPeriod(this,'3m')">3 MESES</button>
      <button class="pb" onclick="setPeriod(this,'1m')">M√äS</button>
    </div>
    <div class="sum-row">
      <div class="sum-chip"><div class="sum-v" id="sm-r">0</div><div class="sum-l">Registros</div></div>
      <div class="sum-chip"><div class="sum-v" id="sm-t">R$0</div><div class="sum-l">Total</div></div>
      <div class="sum-chip"><div class="sum-v" id="sm-m">R$0</div><div class="sum-l">M√©dia/m√™s</div></div>
    </div>
    <div class="chart-box">
      <div class="chart-ttl">Evolu√ß√£o Mensal</div>
      <div class="chart-sub">total gasto por m√™s no per√≠odo</div>
      <div id="lineWrap"><canvas id="chartLine" height="180"></canvas></div>
      <div id="lineND" class="no-data" style="display:none"><div class="no-data-icon">‚óà</div><p>sem dados no per√≠odo</p></div>
    </div>
    <div class="chart-box">
      <div class="chart-ttl">Por Categoria</div>
      <div class="chart-sub">distribui√ß√£o dos gastos por tipo</div>
      <div class="cat-bars" id="catBars"></div>
      <div id="catND" class="no-data" style="display:none"><div class="no-data-icon">‚óà</div><p>sem dados no per√≠odo</p></div>
    </div>
    <div class="chart-box">
      <div class="chart-ttl">Distribui√ß√£o %</div>
      <div class="chart-sub">porcentagem de cada categoria</div>
      <div id="dnutWrap" style="max-width:220px;margin:0 auto;position:relative;"><canvas id="chartDnut" height="220"></canvas></div>
      <div id="dnutLeg" style="margin-top:.9rem;display:flex;flex-direction:column;gap:.4rem;"></div>
      <div id="dnutND" class="no-data" style="display:none"><div class="no-data-icon">‚óà</div><p>sem dados no per√≠odo</p></div>
    </div>
  </div>

  <!-- SIMULA√á√ÉO -->
  <div class="panel" id="panelS">
    <div class="sim-hero">
      <div class="sim-ttl">Simulador de Tarifas</div>
      <div class="sim-desc">Calcule o custo estimado com base na tarifa regional. Selecione o recurso e informe o consumo.</div>
      <div class="sim-region-tag" id="simBadge">‚óà REGI√ÉO: ‚Äî</div>
    </div>

    <div class="type-grid">
      <div class="type-card tc-water" id="tcAgua" onclick="selectSimTipo('Agua')">
        <div class="tc-icon">üíß</div>
        <div class="tc-lbl">√Ågua</div>
        <div class="tc-unit">LITROS</div>
      </div>
      <div class="type-card tc-energy" id="tcEnergia" onclick="selectSimTipo('Energia')">
        <div class="tc-icon">‚ö°</div>
        <div class="tc-lbl">Energia</div>
        <div class="tc-unit">kWh</div>
      </div>
    </div>

    <div class="sim-form" id="simForm" style="display:none;">
      <div class="sim-form-ttl" id="simFormTitle">Configurar simula√ß√£o</div>
      <div class="field">
        <label id="simActLabel">nome da atividade</label>
        <input id="sim-ativ" type="text" placeholder="Ex: Banho, Chuveiro, Ar-condicionado...">
        <div class="error-msg" id="err-sim-ativ">campo obrigat√≥rio</div>
      </div>
      <div class="field">
        <label id="simUnitLabel">consumo (litros)</label>
        <input id="sim-valor" type="number" step="0.01" min="0" placeholder="0.00">
        <div class="error-msg" id="err-sim-valor">valor inv√°lido</div>
      </div>
      <button class="btn btn-gold" id="simCalcBtn" onclick="executarSimulacao()">Calcular custo ‚Üí</button>
    </div>

    <div class="sim-result" id="simResult" style="display:none;">
      <div class="res-label">resultado da simula√ß√£o</div>
      <div class="res-value"><small>R$</small> <span id="resVal">0,00</span></div>
      <div class="res-detail" id="resDetail">‚Äî</div>
      <div class="res-grid">
        <div class="res-chip"><div class="res-chip-lbl">Tarifa unit√°ria</div><div class="res-chip-val" id="resTarifa">‚Äî</div></div>
        <div class="res-chip"><div class="res-chip-lbl">Regi√£o</div><div class="res-chip-val" id="resRegiao">‚Äî</div></div>
      </div>
    </div>

    <div id="simHistWrap" style="display:none;flex-direction:column;gap:.6rem;">
      <div class="sim-hist-header">
        <div class="sim-hist-ttl">Hist√≥rico de Simula√ß√µes</div>
        <div class="sim-hist-count" id="shCount">0 registros</div>
      </div>
      <div class="chart-box" id="simChartBox">
        <div class="chart-ttl">Custo por Simula√ß√£o</div>
        <div class="chart-sub">valor calculado em cada simula√ß√£o realizada</div>
        <canvas id="chartSim" height="180"></canvas>
      </div>
      <div id="shList" style="display:flex;flex-direction:column;gap:.5rem;"></div>
    </div>
  </div>

  <button class="fab" onclick="openModal()" title="Novo consumo">+</button>
</div>

<!-- MODAL CONSUMO -->
<div class="modal-backdrop" id="modalBackdrop" onclick="closeBg(event,'modalBackdrop')">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">Novo Registro</div>
    <div class="modal-sub">// adicione um consumo ao hist√≥rico</div>
    <div style="font-family:'Space Mono',monospace;font-size:.6rem;color:var(--teal);letter-spacing:2px;margin-bottom:.6rem;">TIPO DE CONSUMO</div>
    <div class="tipo-grid">
      <button class="tipo-btn" data-tipo="Energia"     onclick="selectTipo(this)"><span>‚ö°</span>Energia</button>
      <button class="tipo-btn" data-tipo="Agua"        onclick="selectTipo(this)"><span>üíß</span>Agua</button>
      <button class="tipo-btn" data-tipo="Transporte"  onclick="selectTipo(this)"><span>üöó</span>Transporte</button>
      <button class="tipo-btn" data-tipo="Alimenta√ß√£o" onclick="selectTipo(this)"><span>üåΩ</span>Alimenta√ß√£o</button>
      <button class="tipo-btn" data-tipo="Res√≠duos"    onclick="selectTipo(this)"><span>‚ôªÔ∏è</span>Res√≠duos</button>
      <button class="tipo-btn" data-tipo="Outros"      onclick="selectTipo(this)"><span>üì¶</span>Outros</button>
    </div>
    <div class="error-msg" id="err-tipo">selecione um tipo</div>
    <div class="field" style="margin-top:.5rem;"><label>gasto (R$)</label><input id="m-gasto" type="number" step="0.01" min="0" placeholder="0.00"><div class="error-msg" id="err-gasto">valor inv√°lido</div></div>
    <div class="field"><label>data</label><input id="m-data" type="date"><div class="error-msg" id="err-data">selecione uma data</div></div>
    <button class="btn btn-primary" onclick="registrarConsumo()" style="margin-top:.4rem;">Salvar registro ‚Üí</button>
    <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
  </div>
</div>

<!-- MODAL DELETE -->
<div class="modal-backdrop" id="confirmBackdrop" onclick="closeBg(event,'confirmBackdrop')">
  <div class="confirm-modal">
    <div class="modal-handle"></div>
    <div class="confirm-icon">‚ö†</div>
    <div class="confirm-title">Confirmar exclus√£o</div>
    <div class="confirm-sub">Esta a√ß√£o n√£o pode ser desfeita.<br>O registro ser√° removido permanentemente.</div>
    <div class="confirm-row">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancelar</button>
      <button class="btn btn-danger" onclick="confirmarDelete()">Excluir</button>
    </div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê */
const API = 'http://127.0.0.1:8000';
let currentUser = null, consumos = [], simulacoes = [];
let tipoSel = null, simTipo = null, delId = null;
let activePeriod = 'all', chartLine = null, chartDnut = null, chartSim = null;

/* ‚ïê‚ïê‚ïê BG CANVAS ‚ïê‚ïê‚ïê */
(function(){
  const cv=document.getElementById('bgCv'),ctx=cv.getContext('2d');
  let W,H,pts=[];
  const rsz=()=>{W=cv.width=innerWidth;H=cv.height=innerHeight;};
  rsz();addEventListener('resize',rsz);
  for(let i=0;i<80;i++){
    pts.push({
      x:Math.random()*9999,y:Math.random()*9999,
      r:Math.random()*1.6+.2,
      vx:(Math.random()-.5)*.25,vy:(Math.random()-.5)*.25,
      a:Math.random()*.25+.04,
      c:['0,229,200','0,255,136','255,215,0','0,153,204'][Math.floor(Math.random()*4)]
    });
  }
  (function loop(){
    ctx.clearRect(0,0,W,H);
    const g=ctx.createRadialGradient(W*.2,H*.15,0,W*.2,H*.15,W*.8);
    g.addColorStop(0,'rgba(0,40,50,.7)');g.addColorStop(.6,'rgba(2,13,15,.96)');g.addColorStop(1,'rgba(1,8,10,1)');
    ctx.fillStyle=g;ctx.fillRect(0,0,W,H);
    const g2=ctx.createRadialGradient(W*.85,H*.85,0,W*.85,H*.85,W*.4);
    g2.addColorStop(0,'rgba(0,255,136,.04)');g2.addColorStop(1,'rgba(0,255,136,0)');
    ctx.fillStyle=g2;ctx.fillRect(0,0,W,H);
    pts.forEach(p=>{
      p.x+=p.vx;p.y+=p.vy;
      if(p.x<0)p.x=W;if(p.x>W)p.x=0;if(p.y<0)p.y=H;if(p.y>H)p.y=0;
      ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=`rgba(${p.c},${p.a})`;ctx.fill();
    });
    requestAnimationFrame(loop);
  })();
})();

/* ‚ïê‚ïê‚ïê UTIL ‚ïê‚ïê‚ïê */
const $=id=>document.getElementById(id);
function loading(s){$('loadingOverlay').classList.toggle('show',s);}
function toast(msg,type='success'){
  const t=$('toast');
  t.querySelector('.t-icon').textContent=type==='success'?'‚úì':'‚úï';
  $('toastMsg').textContent=msg;
  t.className=`show ${type}`;clearTimeout(t._t);
  t._t=setTimeout(()=>t.className='',3200);
}
function showErr(id,s){$(id).classList.toggle('show',s);}
function validEmail(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);}
function fmtBRL(v){return 'R$ '+parseFloat(v).toFixed(2).replace('.',',');}
function fmtDate(d){return new Date(d+'T00:00:00').toLocaleDateString('pt-BR',{day:'2-digit',month:'short',year:'numeric'});}
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
}

/* ‚ïê‚ïê‚ïê TIPOS ‚ïê‚ïê‚ïê */
const TIPOS={
  'Energia':    {icon:'‚ö°',bg:'rgba(255,215,0,.15)',bd:'rgba(255,215,0,.35)',ch:'#ffd700',acc:'var(--gold)'},
  'Agua':       {icon:'üíß',bg:'rgba(0,229,200,.14)',bd:'rgba(0,229,200,.35)',ch:'#00e5c8',acc:'var(--teal)'},
  'Transporte': {icon:'üöó',bg:'rgba(255,85,85,.14)',bd:'rgba(255,85,85,.3)',ch:'#ff5555',acc:'#ff5555'},
  'Alimenta√ß√£o':{icon:'üåΩ',bg:'rgba(0,255,136,.12)',bd:'rgba(0,255,136,.3)',ch:'#00ff88',acc:'var(--green)'},
  'Res√≠duos':   {icon:'‚ôªÔ∏è',bg:'rgba(0,204,106,.12)',bd:'rgba(0,204,106,.3)',ch:'#00cc6a',acc:'var(--green2)'},
  'Outros':     {icon:'üì¶',bg:'rgba(100,180,200,.1)',bd:'rgba(100,180,200,.3)',ch:'#64b4c8',acc:'#64b4c8'},
};

/* ‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê */
function switchTab(t){
  ['tabH','tabG','tabS'].forEach(id=>$(id).classList.remove('active','active-sim'));
  ['panelH','panelG','panelS'].forEach(id=>{$(id).classList.remove('visible');});
  if(t==='h'){$('tabH').classList.add('active');$('panelH').classList.add('visible');}
  else if(t==='g'){$('tabG').classList.add('active');$('panelG').classList.add('visible');destroyCharts();buildCharts();}
  else{$('tabS').classList.add('active-sim');$('panelS').classList.add('visible');}
}

/* ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê */
async function cadastrar(){
  const nome=$('cad-nome').value.trim(),email=$('cad-email').value.trim(),
        cidade=$('cad-cidade').value.trim(),senha=$('cad-senha').value;
  let ok=true;
  showErr('err-cad-nome',!nome);if(!nome)ok=false;
  showErr('err-cad-email',!validEmail(email));if(!validEmail(email))ok=false;
  showErr('err-cad-cidade',!cidade);if(!cidade)ok=false;
  showErr('err-cad-senha',senha.length<6);if(senha.length<6)ok=false;
  if(!ok)return;
  loading(true);
  try{
    const r=await fetch(`${API}/usuarios`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({nome,email,senha,cidade})});
    if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.detail||'Erro ao criar conta.');}
    const d=await r.json();
    /* Login autom√°tico ap√≥s cadastro */
    currentUser=d.usuario??d;
    sessionStorage.setItem('avUser',JSON.stringify(currentUser));
    setupDash();await loadConsumos();
    showScreen('screenMenu');
    toast(`// conta criada ¬∑ bem-vindo, ${currentUser.nome.split(' ')[0].toUpperCase()}`);
  }catch(e){toast(e.message,'error');}finally{loading(false);}
}

async function login(){
  const email=$('log-email').value.trim(),senha=$('log-senha').value;
  let ok=true;
  showErr('err-log-email',!validEmail(email));if(!validEmail(email))ok=false;
  showErr('err-log-senha',!senha);if(!senha)ok=false;
  if(!ok)return;
  loading(true);
  try{
    const r=await fetch(`${API}/login`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,senha})});
    if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.detail||'credenciais inv√°lidas');}
    const d=await r.json();
    currentUser=d.usuario??d;
    sessionStorage.setItem('avUser',JSON.stringify(currentUser));
    setupDash();await loadConsumos();
    showScreen('screenMenu');
    toast(`// bem-vindo, ${currentUser.nome.split(' ')[0].toUpperCase()}`);
  }catch(e){toast(e.message,'error');}finally{loading(false);}
}

function logout(){
  if(currentUser) sessionStorage.removeItem('avSims_'+currentUser.id);
  currentUser=null;consumos=[];simulacoes=[];destroyCharts();destroySimChart();
  sessionStorage.removeItem('avUser');
  showScreen('screenLogin');toast('// sess√£o encerrada');
}

function setupDash(){
  const fn=currentUser.nome.split(' ')[0];
  $('heroName').textContent=fn.toUpperCase();
  $('userNameDisplay').textContent=fn;
  $('userAvatar').textContent=fn[0].toUpperCase();
  const cidade=currentUser.cidade||'‚Äî',regiao=currentUser.regiao||'‚Äî';
  $('userCityDisplay').textContent=cidade;
  $('heroLoc').textContent=`${cidade} ¬∑ ${regiao}`;
  $('simBadge').textContent=`‚óà REGI√ÉO: ${regiao.toUpperCase()}`;
}

async function loadConsumos(){
  try{
    const r=await fetch(`${API}/consumos/usuario/${currentUser.id}`);
    if(!r.ok)throw new Error();
    consumos=await r.json();
  }catch{consumos=[];}
  renderConsumos();
}

/* ‚ïê‚ïê‚ïê RENDER LIST ‚ïê‚ïê‚ïê */
function renderConsumos(){
  const list=$('consumoList');
  $('statTotal').textContent=consumos.length;
  const total=consumos.reduce((a,c)=>a+parseFloat(c.gasto||0),0);
  $('statGasto').textContent=fmtBRL(total);
  if(!consumos.length){
    list.innerHTML=`<div class="empty-state"><div class="empty-icon">‚óà</div><p>nenhum registro encontrado<br>pressione + para adicionar</p></div>`;
    return;
  }
  const sorted=[...consumos].sort((a,b)=>new Date(b.data)-new Date(a.data));
  list.innerHTML=sorted.map((c,i)=>{
    const m=TIPOS[c.tipo]||TIPOS['Outros'];
    return `<div class="c-item" style="animation-delay:${i*.05}s;--item-acc:${m.ch};">
      <style>.c-item:nth-child(${i+1})::before{background:${m.ch};}</style>
      <div class="c-icon" style="background:${m.bg};border:1px solid ${m.bd};">${m.icon}</div>
      <div class="c-info">
        <div class="c-tipo">${c.tipo}</div>
        <div class="c-data">${fmtDate(c.data)}</div>
      </div>
      <div class="c-right">
        <div class="c-val">${fmtBRL(c.gasto)}</div>
        <button class="del-btn" onclick="askDelete(${c.id})">‚úï</button>
      </div>
    </div>`;
  }).join('');
}

/* ‚ïê‚ïê‚ïê DELETE ‚ïê‚ïê‚ïê */
function askDelete(id){delId=id;$('confirmBackdrop').classList.add('open');}
function closeConfirm(){$('confirmBackdrop').classList.remove('open');delId=null;}
function closeBg(e,id){if(e.target===$(id))e.target.id==='confirmBackdrop'?closeConfirm():closeModal();}
async function confirmarDelete(){
  if(!delId)return;loading(true);
  try{
    const r=await fetch(`${API}/consumos/${delId}`,{method:'DELETE'});
    if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.detail||'erro ao excluir');}
    consumos=consumos.filter(c=>c.id!==delId);renderConsumos();
    if($('panelG').classList.contains('visible')){destroyCharts();buildCharts();}
    closeConfirm();toast('// registro exclu√≠do');
  }catch(e){toast(e.message,'error');}finally{loading(false);}
}

/* ‚ïê‚ïê‚ïê MODAL CONSUMO ‚ïê‚ïê‚ïê */
function openModal(){
  tipoSel=null;
  document.querySelectorAll('.tipo-btn').forEach(b=>b.classList.remove('selected'));
  $('m-gasto').value='';
  $('m-data').value=new Date().toISOString().split('T')[0];
  ['err-tipo','err-gasto','err-data'].forEach(id=>showErr(id,false));
  $('modalBackdrop').classList.add('open');
}
function closeModal(){$('modalBackdrop').classList.remove('open');}
function selectTipo(el){
  document.querySelectorAll('.tipo-btn').forEach(b=>b.classList.remove('selected'));
  el.classList.add('selected');tipoSel=el.dataset.tipo;showErr('err-tipo',false);
}
async function registrarConsumo(){
  const gasto=parseFloat($('m-gasto').value),data=$('m-data').value;
  let ok=true;
  showErr('err-tipo',!tipoSel);if(!tipoSel)ok=false;
  showErr('err-gasto',isNaN(gasto)||gasto<0);if(isNaN(gasto)||gasto<0)ok=false;
  showErr('err-data',!data);if(!data)ok=false;
  if(!ok)return;
  loading(true);
  try{
    const r=await fetch(`${API}/consumos`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tipo:tipoSel,gasto,data,usuario_id:currentUser.id})});
    if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.detail||'erro ao salvar');}
    const novo=await r.json();
    consumos.push(novo);renderConsumos();
    if($('panelG').classList.contains('visible')){destroyCharts();buildCharts();}
    closeModal();toast('// consumo registrado ‚ú¶');
  }catch(e){toast(e.message,'error');}finally{loading(false);}
}

/* ‚ïê‚ïê‚ïê SIMULA√á√ÉO ‚ïê‚ïê‚ïê */
function selectSimTipo(tipo){
  simTipo=tipo;
  $('tcAgua').classList.remove('sel-water');
  $('tcEnergia').classList.remove('sel-energy');
  const isAgua=tipo==='Agua';
  $(isAgua?'tcAgua':'tcEnergia').classList.add(isAgua?'sel-water':'sel-energy');
  const unidade=isAgua?'litros':'kWh',cls=isAgua?'water':'energy';
  $('simFormTitle').innerHTML=`${isAgua?'üíß':'‚ö°'} Simular ${isAgua?'√Ågua':'Energia'} <span class="unit-badge ${cls}">${unidade.toUpperCase()}</span>`;
  $('simUnitLabel').textContent=`consumo (${unidade})`;
  $('sim-ativ').value='';$('sim-valor').value='';
  ['err-sim-ativ','err-sim-valor'].forEach(id=>showErr(id,false));
  $('simResult').style.display='none';
  $('simForm').style.display='';
  $('simCalcBtn').className=`btn ${isAgua?'btn-water':'btn-gold'}`;
}

async function executarSimulacao(){
  const atividade=$('sim-ativ').value.trim();
  const litros=parseFloat($('sim-valor').value);
  let ok=true;
  showErr('err-sim-ativ',!atividade);if(!atividade)ok=false;
  showErr('err-sim-valor',isNaN(litros)||litros<=0);if(isNaN(litros)||litros<=0)ok=false;
  if(!ok)return;

  const isAgua=simTipo==='Agua';
  /* Convers√£o: se for √°gua, usu√°rio digita litros ‚Üí enviar em m¬≥ para API */
  const consumoParaAPI=isAgua ? +(litros/1000).toFixed(6) : litros;

  const payload={atividade,tipo:simTipo,consumo_valor:consumoParaAPI.toString(),usuario_id:currentUser.id};
  loading(true);
  try{
    const r=await fetch(`${API}/simulacao`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!r.ok){
      const e=await r.json().catch(()=>({}));
      const msg=Array.isArray(e.detail)?e.detail.map(d=>`${d.loc?.slice(-1)[0]}: ${d.msg}`).join(' | '):(e.detail||'erro na simula√ß√£o');
      throw new Error(typeof msg==='string'?msg:'erro na simula√ß√£o');
    }
    const d=await r.json();
    const res=d.resultado;
    $('resVal').textContent=parseFloat(res.total).toFixed(2).replace('.',',');
    /* Detalhe mostra litros (exibi√ß√£o) e m¬≥ (enviado) para transpar√™ncia */
    $('resDetail').innerHTML=
      `<strong>${atividade}</strong><br>`+
      (isAgua
        ? `${litros.toLocaleString('pt-BR')} L ‚Üí <strong>${consumoParaAPI.toFixed(4)} m¬≥</strong> ¬∑ tarifa da regi√£o <strong>${res.regiao}</strong>`
        : `${litros} kWh ¬∑ tarifa da regi√£o <strong>${res.regiao}</strong>`);
    $('resTarifa').textContent=`R$ ${parseFloat(res.valor_unitario).toFixed(4).replace('.',',')}${isAgua?' /m¬≥':' /kWh'}`;
    $('resRegiao').textContent=res.regiao;
    $('simResult').style.display='';
    /* Salva litros no hist√≥rico local para exibi√ß√£o, mas m¬≥ foi o que foi calculado */
    simulacoes.unshift({atividade,tipo:simTipo,consumo_litros:isAgua?litros:null,consumo_valor:consumoParaAPI,valor_calculado:res.total,regiao:res.regiao,ts:new Date()});
    sessionStorage.setItem('avSims_'+currentUser.id, JSON.stringify(simulacoes));
    renderSimHist();
    toast(`// R$ ${parseFloat(res.total).toFixed(2).replace('.',',')} calculado`);
  }catch(e){toast(e.message,'error');}finally{loading(false);}
}

function renderSimHist(){
  if(!simulacoes.length)return;
  $('simHistWrap').style.display='flex';
  $('shCount').textContent=`${simulacoes.length} registro${simulacoes.length>1?'s':''}`;

  // Lista de itens
  $('shList').innerHTML=simulacoes.map((s,i)=>{
    const isAgua=s.tipo==='Agua';
    return `<div class="sh-item" style="animation-delay:${i*.05}s">
      <div class="sh-ico" style="background:${isAgua?'rgba(0,229,200,.14)':'rgba(255,215,0,.14)'};border:1px solid ${isAgua?'rgba(0,229,200,.3)':'rgba(255,215,0,.3)'};">${isAgua?'üíß':'‚ö°'}</div>
      <div class="sh-info">
        <div class="sh-ativ">${s.atividade}</div>
        <div class="sh-meta">${isAgua ? ((s.consumo_litros ? s.consumo_litros.toLocaleString('pt-BR') : '') + ' L ‚Üí ' + Number(s.consumo_valor).toFixed(4) + ' m¬≥') : (s.consumo_valor + ' kWh')} ¬∑ ${s.regiao}</div>
      </div>
      <div class="sh-val">${fmtBRL(s.valor_calculado)}</div>
    </div>`;
  }).join('');

  // Gr√°fico de barras
  destroySimChart();
  const labels = [...simulacoes].reverse().map((s,i)=> s.atividade.length>14 ? s.atividade.slice(0,13)+'‚Ä¶' : s.atividade);
  const values = [...simulacoes].reverse().map(s=>parseFloat(s.valor_calculado));
  const colors = [...simulacoes].reverse().map(s=>s.tipo==='Agua'?'rgba(0,229,200,.85)':'rgba(255,215,0,.85)');
  const borders= [...simulacoes].reverse().map(s=>s.tipo==='Agua'?'#00e5c8':'#ffd700');

  const ctx=$('chartSim').getContext('2d');
  chartSim=new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[{
        data:values,
        backgroundColor:colors,
        borderColor:borders,
        borderWidth:1.5,
        borderRadius:6,
        borderSkipped:false,
      }]
    },
    options:{
      responsive:true,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{display:false},
        tooltip:{
          backgroundColor:'rgba(2,13,15,.97)',
          titleColor:'#00e5c8',bodyColor:'#e8f8f5',
          borderColor:'rgba(0,229,200,.25)',borderWidth:1,padding:12,
          titleFont:{family:"'Space Mono',monospace",size:10},
          bodyFont:{family:"'Space Mono',monospace",size:11},
          callbacks:{
            title:items=>{
              const idx=[...simulacoes].length-1-items[0].dataIndex;
              return simulacoes[[...simulacoes].length-1-items[0].dataIndex]?.atividade||items[0].label;
            },
            label:item=>'  '+fmtBRL(item.parsed.y)
          }
        }
      },
      scales:{
        x:{
          grid:{color:'rgba(0,229,200,.05)'},
          ticks:{color:'rgba(74,138,144,.8)',font:{family:"'Space Mono',monospace",size:9},maxRotation:30}
        },
        y:{
          grid:{color:'rgba(0,229,200,.05)'},
          ticks:{color:'rgba(74,138,144,.8)',font:{family:"'Space Mono',monospace",size:9},callback:v=>'R$'+v},
          beginAtZero:true
        }
      }
    }
  });
}

/* ‚ïê‚ïê‚ïê CHARTS ‚ïê‚ïê‚ïê */
function destroyCharts(){
  if(chartLine){chartLine.destroy();chartLine=null;}
  if(chartDnut){chartDnut.destroy();chartDnut=null;}
}
function destroySimChart(){
  if(chartSim){chartSim.destroy();chartSim=null;}
}
function filterPeriod(arr){
  const now=new Date();
  return arr.filter(c=>{
    const d=new Date(c.data+'T00:00:00');
    if(activePeriod==='all')return true;
    if(activePeriod==='year')return d.getFullYear()===now.getFullYear();
    if(activePeriod==='3m'){const cut=new Date(now);cut.setMonth(cut.getMonth()-3);return d>=cut;}
    if(activePeriod==='1m')return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
    return true;
  });
}
function setPeriod(btn,p){
  document.querySelectorAll('.pb').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');activePeriod=p;destroyCharts();buildCharts();
}
function buildCharts(){
  const f=filterPeriod(consumos);
  const tot=f.reduce((a,c)=>a+parseFloat(c.gasto||0),0);
  const mos=new Set(f.map(c=>c.data.slice(0,7)));
  const med=mos.size>0?tot/mos.size:0;
  $('sm-r').textContent=f.length;
  $('sm-t').textContent=tot>=1000?(tot/1000).toFixed(1)+'k':fmtBRL(tot);
  $('sm-m').textContent=med>=1000?(med/1000).toFixed(1)+'k':fmtBRL(med);
  buildLine(f);buildCats(f);buildDnut(f);
}

const CG={grid:'rgba(0,229,200,.05)',tick:'rgba(74,138,144,.8)',font:{family:"'Space Mono',monospace",size:10}};

function buildLine(data){
  const w=$('lineWrap'),nd=$('lineND');
  if(!data.length){w.style.display='none';nd.style.display='flex';return;}
  w.style.display='';nd.style.display='none';
  const map={};
  data.forEach(c=>{const k=c.data.slice(0,7);map[k]=(map[k]||0)+parseFloat(c.gasto||0);});
  const keys=Object.keys(map).sort(),vals=keys.map(k=>+map[k].toFixed(2));
  const lbls=keys.map(k=>{const[y,m]=k.split('-');return new Date(y,+m-1).toLocaleDateString('pt-BR',{month:'short',year:'2-digit'}).toUpperCase();});
  const ctx=$('chartLine').getContext('2d');
  chartLine=new Chart(ctx,{
    type:'line',
    data:{labels:lbls,datasets:[{
      data:vals,borderColor:'#00e5c8',
      backgroundColor:c=>{const g=c.chart.ctx.createLinearGradient(0,0,0,c.chart.height);g.addColorStop(0,'rgba(0,229,200,.3)');g.addColorStop(1,'rgba(0,229,200,0)');return g;},
      borderWidth:2,pointBackgroundColor:'#020d0f',pointBorderColor:'#00e5c8',
      pointBorderWidth:2,pointRadius:5,pointHoverRadius:7,tension:.4,fill:true
    }]},
    options:{
      responsive:true,interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:false},tooltip:{
        backgroundColor:'rgba(2,13,15,.97)',titleColor:'#00e5c8',bodyColor:'#e8f8f5',
        borderColor:'rgba(0,229,200,.25)',borderWidth:1,padding:12,
        titleFont:{family:"'Space Mono',monospace",size:11},
        bodyFont:{family:"'Space Mono',monospace",size:11},
        callbacks:{title:i=>'‚óà '+i[0].label,label:i=>'  '+fmtBRL(i.parsed.y)}
      }},
      scales:{
        x:{grid:{color:CG.grid},ticks:{color:CG.tick,font:CG.font}},
        y:{grid:{color:CG.grid},ticks:{color:CG.tick,font:CG.font,callback:v=>'R$'+v},beginAtZero:true}
      }
    }
  });
}

function buildCats(data){
  const el=$('catBars'),nd=$('catND');
  if(!data.length){el.style.display='none';nd.style.display='flex';return;}
  el.style.display='';nd.style.display='none';
  const map={};
  data.forEach(c=>{map[c.tipo]=(map[c.tipo]||0)+parseFloat(c.gasto||0);});
  const tot=Object.values(map).reduce((a,b)=>a+b,0);
  const sorted=Object.entries(map).sort((a,b)=>b[1]-a[1]);
  el.innerHTML=sorted.map(([tipo,val])=>{
    const m=TIPOS[tipo]||TIPOS['Outros'],pct=tot>0?((val/tot)*100).toFixed(1):0;
    return `<div class="cat-row">
      <div class="cat-top">
        <div class="cat-nm"><span>${m.icon}</span>${tipo}</div>
        <div style="display:flex;gap:.65rem;align-items:center;">
          <span class="cat-pct">${pct}%</span>
          <span class="cat-amt">${fmtBRL(val)}</span>
        </div>
      </div>
      <div class="cat-track"><div class="cat-fill" style="width:0%;background:${m.ch};" data-w="${pct}"></div></div>
    </div>`;
  }).join('');
  requestAnimationFrame(()=>{document.querySelectorAll('.cat-fill').forEach(f=>{f.style.width=f.dataset.w+'%';});});
}

function buildDnut(data){
  const w=$('dnutWrap'),leg=$('dnutLeg'),nd=$('dnutND');
  if(!data.length){w.style.display='none';leg.style.display='none';nd.style.display='flex';return;}
  w.style.display='';leg.style.display='';nd.style.display='none';
  const map={};
  data.forEach(c=>{map[c.tipo]=(map[c.tipo]||0)+parseFloat(c.gasto||0);});
  const tot=Object.values(map).reduce((a,b)=>a+b,0);
  const lbls=Object.keys(map),vals=lbls.map(l=>+map[l].toFixed(2)),cols=lbls.map(l=>(TIPOS[l]||TIPOS['Outros']).ch);
  leg.innerHTML=lbls.map((l,i)=>`
    <div style="display:flex;align-items:center;justify-content:space-between;padding:.45rem .7rem;background:rgba(0,0,0,.2);border:1px solid rgba(0,229,200,.1);border-radius:8px;">
      <div style="display:flex;align-items:center;gap:.5rem;">
        <div style="width:9px;height:9px;border-radius:2px;background:${cols[i]};flex-shrink:0;"></div>
        <span style="font-size:.78rem;font-weight:700;color:var(--white);">${(TIPOS[l]||TIPOS['Outros']).icon} ${l}</span>
      </div>
      <div style="display:flex;gap:.65rem;align-items:center;">
        <span style="font-family:'Space Mono',monospace;font-size:.62rem;color:var(--muted);">${tot>0?((vals[i]/tot)*100).toFixed(1):0}%</span>
        <span style="font-family:'Orbitron',monospace;font-size:.88rem;font-weight:700;color:var(--gold);">${fmtBRL(vals[i])}</span>
      </div>
    </div>`).join('');
  const ctx=$('chartDnut').getContext('2d');
  chartDnut=new Chart(ctx,{
    type:'doughnut',
    data:{labels:lbls,datasets:[{data:vals,backgroundColor:cols,borderColor:'rgba(2,13,15,.9)',borderWidth:3,hoverOffset:8}]},
    options:{
      responsive:true,cutout:'68%',
      plugins:{legend:{display:false},tooltip:{
        backgroundColor:'rgba(2,13,15,.97)',titleColor:'#00e5c8',bodyColor:'#e8f8f5',
        borderColor:'rgba(0,229,200,.25)',borderWidth:1,padding:12,
        titleFont:{family:"'Space Mono',monospace",size:10},
        bodyFont:{family:"'Space Mono',monospace",size:10},
        callbacks:{label:c=>`  ${fmtBRL(c.parsed)} (${tot>0?((c.parsed/tot)*100).toFixed(1):0}%)`}
      }}
    },
    plugins:[{
      id:'ct',
      beforeDraw(chart){
        const{ctx:c,chartArea:{width:w,height:h,left:l,top:t}}=chart;
        c.save();
        const cx=l+w/2,cy=t+h/2;
        c.font=`900 1.1rem 'Orbitron',monospace`;
        c.fillStyle='#e8f8f5';c.textAlign='center';c.textBaseline='middle';
        c.fillText(fmtBRL(tot),cx,cy-8);
        c.font=`400 .56rem 'Space Mono',monospace`;
        c.fillStyle='#4a8a90';c.fillText('total gasto',cx,cy+10);
        c.restore();
      }
    }]
  });
}

/* ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê */
$('m-data').value=new Date().toISOString().split('T')[0];
(async function init(){
  const s=sessionStorage.getItem('avUser');
  if(!s)return;
  try{
    currentUser=JSON.parse(s);
    const savedSims=sessionStorage.getItem('avSims_'+currentUser.id);
    if(savedSims) { simulacoes=JSON.parse(savedSims); }
    setupDash();await loadConsumos();
    showScreen('screenMenu');
    if(simulacoes.length) renderSimHist();
  }catch{sessionStorage.removeItem('avUser');}
})();
</script>
</body>
</html>